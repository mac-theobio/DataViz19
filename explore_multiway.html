<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>exploring multivariate data</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="main.css" type="text/css" />
</head>
<body>
<header class="site-header">
<div class="wrapper">
	<h1 class="title">
		<a href="index.html">Statistics 744, McMaster University</a>
	</h1>
	<div style="text-align:center">
		<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Minard.png/640px-Minard.png" width=80%>
	</div>
</div>
</header>

<div id="header">
<h1 class="title">exploring multivariate data</h1>
</div>
<!-- 
apa.csl is a slightly hacked version of APA 
  (modified for "et al" after 2 authors in text)
-->
<!-- .refs is style for reference page (small text) -->
<style>
.refs {
   font-size: 16px;
}
h2 { 
 color: #3399ff;        
}
h3 { 
 color: #3399ff;        
}
.title-slide {
   background-color: #55bbff;
}
</style>
<!--    content: url(https://i.creativecommons.org/l/by-sa/4.0/88x31.png)
>
<!-- Limit image width and height -->
<style type="text/css">
img {     
  max-height: 560px;     
  max-width: 800px; 
}
</style>
<pre><code>library(pgmm)    ## for olives data
library(skimr)   ## for text-based summaries
library(ggplot2); theme_set(theme_bw())
library(GGally)   ## pairs plots etc.
library(corrplot) ## correlation plots
library(dplyr)    ## data manipulation
library(tidyr)
library(readr)    ## read CSV files
library(agridat)  ## agricultural data sets</code></pre>
<h2 id="smooth-curves-glm-vs-loess-vs-gam">smooth curves; (g)lm vs loess vs GAM</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Local_regression">loess</a>
<ul>
<li>local polynomial regression (quadratic by default)</li>
<li>used by default for N&lt;1000</li>
<li>“Somewhat anecdotally, ‘loess’ gives a better appearance, but is O(N^2) in memory, so does not work for larger datasets”</li>
<li>increase <code>span</code> to get smoother result</li>
<li>could use <code>method.args = list(degree=1)</code> to get locally linear fit …</li>
</ul></li>
</ul>
<h2 id="gam">GAM</h2>
<ul>
<li>additive model</li>
<li>penalized regression (decides on smoothness automatically)</li>
<li>typical results are smoother than loess</li>
<li>may oversmooth (try adjusting max knots, e.g. <code>formula = y ~ s(x,k=10,bs="cs")</code>)</li>
<li>can use e.g. <code>method.args = list(family=poisson)</code> to account for data ranges</li>
</ul>
<h2 id="glms">(G)LMs</h2>
<ul>
<li>simplest, smoothest</li>
<li>but also most constraining</li>
<li>can fit polynomials, e.g. <code>formula= y ~ poly(x,2)</code></li>
<li>use <code>method.arg=list(family=...)</code> as appropriate</li>
</ul>
<h2 id="multiple-continuous-predictors-single-response">multiple continuous predictors, single response</h2>
<p>“melt” data to long format (<code>gather()</code>, <code>pivot_longer()</code>)</p>
<pre><code>cars_long &lt;- pivot_longer(mtcars,
                          -mpg,  ## DON&#39;T melt mpg
                          names_to=&quot;xvar&quot;,values_to=&quot;xval&quot;)
g1 &lt;- (ggplot(cars_long,aes(xval,mpg)) +
       geom_point()+
       facet_wrap(~xvar,scale=&quot;free_x&quot;)+
       geom_smooth()
)</code></pre>
<hr />
<pre><code>print(g1)  

## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/g1plot-1.png" /></p>
<h2 id="multivariate-data">multivariate data</h2>
<pre><code>data(olive,package=&quot;pgmm&quot;)
data(fisher.barley,package=&quot;agridat&quot;)</code></pre>
<h2 id="hints-on-looking-for-stuff">Hints on looking for stuff</h2>
<pre><code>library(&quot;sos&quot;)
findFn(&quot;barley&quot;)      ## full-text search of CRAN
?RSiteSearch          ## similar
help.search(&quot;barley&quot;,agrep=FALSE) ## search in *installed* package</code></pre>
<h2 id="order-data-and-factor-ize-year">Order data and factor-ize year</h2>
<pre><code>ff &lt;- (fisher.barley
  %&gt;% mutate(gen=reorder(gen,yield),
             env=reorder(env,yield),
             year=factor(year))
  %&gt;% arrange(gen,env)
)</code></pre>
<hr />
<pre><code>gg0 &lt;- (ggplot(ff,
               aes(x=env,y=yield,colour=year,group=year))
  ## geom_boxplot(aes(x=gen,y=yield,fill=factor(year)))
  + geom_point()+geom_line()
  + facet_wrap(~gen,nrow=1)  ## 1-row layout
)</code></pre>
<hr />
<pre><code>print(gg0)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/barley_print-1.png" /></p>
<hr />
<p>Hard to see x-axis labels: try rotating? <code>coord_flip()</code> doesn’t interact well with faceting (see also <code>ggstance</code>)</p>
<hr />
<pre><code>gg0_h &lt;- (ggplot(ff,
               aes(y=env,x=yield,colour=year,group=year))
        ## geom_boxplot(aes(x=gen,y=yield,fill=factor(year)))
  + geom_point()
  + geom_path()
  + facet_wrap(~gen,nrow=1)
  + theme(panel.spacing=grid::unit(0,&quot;lines&quot;))
  + coord_fixed(ratio=20)
)</code></pre>
<hr />
<pre><code>print(gg0_h)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/print2-1.png" /></p>
<hr />
<p>maybe use <code>ncol=1, coord_fixed(ratio=1/20)</code>? Then yields would be aligned along the same axis (but a tall skinny plot might not be convenient)</p>
<p>Could calculate <em>differences</em> …</p>
<h2 id="olives">olives</h2>
<pre><code>## restore names to data set 
olive_regions &lt;-
  read_csv(&quot;data/olive_regions.csv&quot;)
olive2 &lt;- 
  (full_join(olive_regions,olive,
      by=c(&quot;region_num&quot; = &quot;Region&quot;,
           &quot;area_num&quot; = &quot;Area&quot;))  
  %&gt;% select(-c(region_num,area_num))
  %&gt;% mutate_at(c(&quot;region&quot;,&quot;area&quot;),factor)
  )
colvec &lt;- c(&quot;red&quot;,&quot;blue&quot;,&quot;goldenrod&quot;)</code></pre>
<hr />
<p>First a pairs plot in base R:</p>
<pre><code>panel.density &lt;- function(x, ...) {
  usr &lt;- par(&quot;usr&quot;); on.exit(par(usr))
  par(usr = c(usr[1:2], 0, 1.5) ) ## modify y limits
  h &lt;- lapply(split(x,olive2$region),density)
  for (i in 1:length(h)) {
    lines(h[[i]]$x,h[[i]]$y/max(h[[i]]$y),col=colvec[i])
  }
}
num_cols &lt;- 3:ncol(olive2)</code></pre>
<hr />
<pre><code>pairs(olive2[,num_cols],
      gap=0,     ## no spaces
      cex=0.5,   ## smaller points
      col=colvec[olive2$region],
      diag.panel=panel.density)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/pairs2-1.png" /></p>
<p>This took significant hacking to get the way I wanted it!</p>
<pre><code>## https://stackoverflow.com/questions/37889222/change-colors-in-ggpairs-now-that-params-is-deprecated
ggp1 &lt;- ggpairs(olive2,
                lower=list(continuous= function(data,mapping,...) {
                  (ggally_points(data,mapping,..., size=1)
                    + scale_colour_brewer(palette=&quot;Dark2&quot;)
                  )
                }),
                diag = list(continuous=function(data,mapping,...) {
                  (ggplot(data,mapping) 
                    + geom_density(...)
                    + scale_colour_brewer(palette=&quot;Dark2&quot;)
                  )
                }),
                upper = list(continuous=function(data,mapping, ...) {
                  (ggally_cor(data,mapping,...)
                    + scale_colour_brewer(palette=&quot;Dark2&quot;)
                  )
                }),
                columns=num_cols,
                mapping=aes(colour=region))
## https://github.com/ggobi/ggally/issues/14
theme_set(theme_bw()+ theme(panel.spacing=grid::unit(0,&quot;lines&quot;)))</code></pre>
<hr />
<pre><code>print(ggp1)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/print_ggpairs-1.png" /></p>
<hr />
<pre><code>car::scatterplotMatrix(olive2[,num_cols],
                       groups=olive2$region,
                       gap=0)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/car-1.png" /></p>
<hr />
<p>What about just showing correlations? (Probably not “exploratory”.)</p>
<pre><code>library(corrplot)
corrplot(cor(olive2[,num_cols]),method=&quot;ellipse&quot;)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/corrplot-1.png" /></p>
<hr />
<pre><code>corrplot.mixed(cor(olive2[,num_cols]),lower=&quot;number&quot;,upper=&quot;ellipse&quot;)</code></pre>
<p><img src="explore_multiway_files/figure-markdown_strict/mixed-1.png" /></p>
<div id="footer">
	<div style="text-align:center">
		<a href="index.html">Course home page</a>
	</div>
</div>
</body>
</html>
